# Redis Session æŒä¹…åŒ–é…ç½®

## æ¦‚è¿°

ç°åœ¨ç³»ç»Ÿå·²ç»é…ç½®ä¸ºä½¿ç”¨Redisè¿›è¡ŒçœŸæ­£çš„SessionæŒä¹…åŒ–ï¼Œé€‚ç”¨äºServerlessåœºæ™¯ã€‚

## é…ç½®è¯¦æƒ…

### 1. Redisé€‚é…å™¨
- **æ–‡ä»¶**: `src/lib/redis-adapter.ts`
- **åŠŸèƒ½**: å®Œæ•´çš„NextAuthé€‚é…å™¨å®ç°
- **å­˜å‚¨**: ç”¨æˆ·ã€ä¼šè¯ã€éªŒè¯ä»¤ç‰Œ

### 2. Sessionç­–ç•¥
- **ç­–ç•¥**: `database` (æ•°æ®åº“æ¨¡å¼)
- **å­˜å‚¨**: Redis
- **è¿‡æœŸæ—¶é—´**: 30å¤©

### 3. å­˜å‚¨çš„æ•°æ®ç±»å‹

#### ç”¨æˆ·æ•°æ® (`nextauth:user:*`)
```json
{
  "id": "google_123456789",
  "email": "user@bu.edu",
  "name": "ç”¨æˆ·å",
  "image": "å¤´åƒURL",
  "accounts": [
    {
      "provider": "google",
      "providerAccountId": "google_123",
      "type": "oauth",
      "access_token": "...",
      "refresh_token": "...",
      "expires_at": 1234567890,
      "scope": "openid email profile",
      "token_type": "Bearer",
      "id_token": "..."
    }
  ]
}
```

#### ä¼šè¯æ•°æ® (`nextauth:session:*`)
```json
{
  "id": "session_456",
  "sessionToken": "session_token_456",
  "userId": "user_123",
  "expires": "2024-01-01T00:00:00.000Z"
}
```

#### éªŒè¯ä»¤ç‰Œ (`nextauth:verification_token:*`)
```json
{
  "id": "token_789",
  "token": "verification_token_789",
  "identifier": "user@bu.edu",
  "expires": "2024-01-01T00:00:00.000Z"
}
```

## åŠŸèƒ½ç‰¹æ€§

- âœ… **çœŸæ­£çš„SessionæŒä¹…åŒ–**: ä½¿ç”¨Rediså­˜å‚¨ä¼šè¯æ•°æ®
- âœ… **Serverlesså‹å¥½**: æ”¯æŒæ— çŠ¶æ€éƒ¨ç½²
- âœ… **é«˜å¯ç”¨æ€§**: Redisæä¾›å¯é çš„æ•°æ®å­˜å‚¨
- âœ… **è‡ªåŠ¨è¿‡æœŸ**: ä¼šè¯è‡ªåŠ¨è¿‡æœŸç®¡ç†
- âœ… **å¤šå®ä¾‹æ”¯æŒ**: æ”¯æŒå¤šæœåŠ¡å™¨éƒ¨ç½²

## ä½¿ç”¨æ–¹æ³•

### 1. æŸ¥çœ‹Sessionæ•°æ®
```bash
# æŸ¥çœ‹æ‰€æœ‰ä¼šè¯
redis-cli keys "nextauth:session:*"

# æŸ¥çœ‹ç‰¹å®šä¼šè¯
redis-cli get "nextauth:session:session_token_xxx"
```

### 2. æŸ¥çœ‹ç”¨æˆ·æ•°æ®
```bash
# æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·
redis-cli keys "nextauth:user:*"

# æŸ¥çœ‹ç‰¹å®šç”¨æˆ·
redis-cli get "nextauth:user:user_id_xxx"
```

### 3. æŸ¥çœ‹éªŒè¯ä»¤ç‰Œ
```bash
# æŸ¥çœ‹æ‰€æœ‰éªŒè¯ä»¤ç‰Œ
redis-cli keys "nextauth:verification_token:*"
```

## å·¥ä½œæµç¨‹

1. **ç”¨æˆ·ç™»å½•**:
   - ç”¨æˆ·é€šè¿‡Google OAuthç™»å½•
   - ç³»ç»ŸéªŒè¯é‚®ç®±åŸŸå
   - åˆ›å»ºç”¨æˆ·è®°å½•å­˜å‚¨åˆ°Redis
   - åˆ›å»ºä¼šè¯è®°å½•å­˜å‚¨åˆ°Redis

2. **ä¼šè¯éªŒè¯**:
   - ç”¨æˆ·è®¿é—®å—ä¿æŠ¤é¡µé¢
   - NextAuthä»Redisè·å–ä¼šè¯æ•°æ®
   - éªŒè¯ä¼šè¯æœ‰æ•ˆæ€§
   - è¿”å›ç”¨æˆ·ä¿¡æ¯

3. **ä¼šè¯ç®¡ç†**:
   - è‡ªåŠ¨å¤„ç†ä¼šè¯è¿‡æœŸ
   - æ”¯æŒä¼šè¯æ›´æ–°å’Œåˆ é™¤
   - å¤šå®ä¾‹é—´ä¼šè¯åŒæ­¥

## ä¼˜åŠ¿

- ğŸš€ **é«˜æ€§èƒ½**: Redisæä¾›å¿«é€Ÿçš„æ•°æ®è®¿é—®
- ğŸ”’ **å®‰å…¨æ€§**: ä¼šè¯æ•°æ®å®‰å…¨å­˜å‚¨
- ğŸ“ˆ **å¯æ‰©å±•**: æ”¯æŒé›†ç¾¤éƒ¨ç½²
- ğŸ”„ **æ— çŠ¶æ€**: é€‚åˆServerlessæ¶æ„
- ğŸ“Š **å¯ç›‘æ§**: å®Œæ•´çš„ä¼šè¯ç®¡ç†

## éƒ¨ç½²å»ºè®®

### ç”Ÿäº§ç¯å¢ƒ
1. ä½¿ç”¨Redisé›†ç¾¤æé«˜å¯ç”¨æ€§
2. é…ç½®RedisæŒä¹…åŒ–
3. è®¾ç½®é€‚å½“çš„è¿‡æœŸæ—¶é—´
4. ç›‘æ§Redisæ€§èƒ½

### å¼€å‘ç¯å¢ƒ
1. ä½¿ç”¨æœ¬åœ°Redisè¿›è¡Œæµ‹è¯•
2. å¯ç”¨è°ƒè¯•æ¨¡å¼æŸ¥çœ‹æ—¥å¿—
3. å®šæœŸæ¸…ç†æµ‹è¯•æ•°æ®

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **Redisè¿æ¥å¤±è´¥**: æ£€æŸ¥RedisæœåŠ¡çŠ¶æ€
2. **ä¼šè¯ä¸¢å¤±**: æ£€æŸ¥Redisæ•°æ®æŒä¹…åŒ–
3. **æ€§èƒ½é—®é¢˜**: ç›‘æ§Rediså†…å­˜ä½¿ç”¨

### è°ƒè¯•å‘½ä»¤
```bash
# æ£€æŸ¥Redisè¿æ¥
redis-cli ping

# æŸ¥çœ‹æ‰€æœ‰NextAuthæ•°æ®
redis-cli keys "nextauth:*"

# ç›‘æ§Redisæ€§èƒ½
redis-cli info
``` 