# ç¼©åœˆæŠ½å¥–ç³»ç»Ÿ

åŸºäº Next.js çš„é«˜å¹¶å‘ç­”é¢˜æŠ½å¥–ç³»ç»Ÿï¼Œæ”¯æŒé‚®ç®±éªŒè¯ç ç™»å½•ã€WebSocket å®æ—¶é€šä¿¡ã€æŒ‰é¢˜ç›®é€è½®æ·˜æ±°ç”¨æˆ·çš„æŠ½å¥–æ¸¸æˆã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ… **é‚®ç®±éªŒè¯ç ç™»å½•** - å®‰å…¨çš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- âš¡ **å®æ—¶ WebSocket é€šä¿¡** - Socket.IO å®ç°å®æ—¶æ•°æ®åŒæ­¥
- ğŸ¯ **æŒ‰é¢˜ç›®é€è½®æ·˜æ±°** - æ™ºèƒ½çš„æ·˜æ±°æœºåˆ¶
- ğŸ† **æœ€åä¸€äººè·èƒœ** - æ”¯æŒå¤§å‹ç«èµ›æ´»åŠ¨
- ğŸ“± **å“åº”å¼è®¾è®¡** - æ”¯æŒæ‰‹æœºç«¯ç­”é¢˜å’Œå¤§å±ç®¡ç†
- ğŸš€ **é«˜å¹¶å‘æ”¯æŒ** - é¢„è®¡æ”¯æŒ 500+ ç”¨æˆ·åŒæ—¶åœ¨çº¿

## æŠ€æœ¯æ ˆ

- **å‰ç«¯**: Next.js 15 + TypeScript + Tailwind CSS
- **åç«¯**: Next.js API Routes + Socket.IO
- **æ•°æ®åº“**: Redis (ç”¨æˆ·çŠ¶æ€ã€æ¸¸æˆæ•°æ®)
- **è®¤è¯**: JWT + é‚®ç®±éªŒè¯ç 
- **é‚®ä»¶æœåŠ¡**: Nodemailer
- **éƒ¨ç½²**: Docker + PM2 + NGINX

## ç³»ç»Ÿæ¶æ„

```
ç”¨æˆ·ç«¯ (æ‰‹æœº) â†â†’ Socket.IO â†â†’ Next.js Server â†â†’ Redis
                    â†‘
ç®¡ç†ç«¯ (å¤§å±) â†â†’ Socket.IO
```

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

- Node.js 18+
- Redis æœåŠ¡å™¨
- SMTP é‚®ä»¶æœåŠ¡ (æ¨è Gmail)

### 2. å®‰è£…ä¾èµ–

```bash
npm install
```

### 3. ç¯å¢ƒé…ç½®

åˆ›å»º `.env.local` æ–‡ä»¶ï¼š

```env
# Redis é…ç½®
REDIS_URL=redis://localhost:6379

# JWT å¯†é’¥ (ç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨å¤æ‚å¯†é’¥)
JWT_SECRET=your_super_secure_jwt_secret_key_here

# é‚®ä»¶æœåŠ¡é…ç½® (Gmail SMTP)
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USER=your_email@gmail.com
EMAIL_PASS=your_app_password

# åº”ç”¨é…ç½®
NEXT_PUBLIC_SITE_URL=http://localhost:3000
DEFAULT_ROOM_ID=main_room
```

### 4. å¯åŠ¨ Redis

```bash
# macOS (ä½¿ç”¨ Homebrew)
brew install redis
brew services start redis

# Ubuntu/Debian
sudo apt-get install redis-server
sudo systemctl start redis

# Docker
docker run -d -p 6379:6379 redis:alpine
```

### 5. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

è®¿é—® http://localhost:3000

## é¡µé¢è¯´æ˜

| é¡µé¢ | è·¯å¾„ | æè¿° |
|------|------|------|
| ä¸»é¡µ | `/` | ç³»ç»Ÿä»‹ç»å’Œå¯¼èˆª |
| ç”¨æˆ·ç™»å½• | `/login` | é‚®ç®±éªŒè¯ç ç™»å½• |
| ç”¨æˆ·ç­”é¢˜ | `/play` | ç­”é¢˜ç•Œé¢ |
| ç®¡ç†å¤§å± | `/admin` | æ§åˆ¶æ¸¸æˆæµç¨‹ |

## API æ¥å£

### è®¤è¯æ¥å£

- `POST /api/auth/send-code` - å‘é€éªŒè¯ç 
- `POST /api/auth/verify-code` - éªŒè¯ç™»å½•

### ç®¡ç†æ¥å£

- `POST /api/admin/next-question` - å‘å¸ƒä¸‹ä¸€é¢˜
- `GET /api/admin/game-stats` - è·å–æ¸¸æˆç»Ÿè®¡
- `POST /api/admin/reset-game` - é‡ç½®æ¸¸æˆ

### WebSocket äº‹ä»¶

#### æœåŠ¡ç«¯å¹¿æ’­äº‹ä»¶

- `new_question` - æ–°é¢˜ç›®å‘å¸ƒ
- `countdown` - å€’è®¡æ—¶æ›´æ–°
- `round_result` - è½®æ¬¡ç»“æœ
- `eliminated` - ç”¨æˆ·æ·˜æ±°é€šçŸ¥
- `game_ended` - æ¸¸æˆç»“æŸ
- `game_state` - æ¸¸æˆçŠ¶æ€æ›´æ–°

#### å®¢æˆ·ç«¯å‘é€äº‹ä»¶

- `submit_answer` - æäº¤ç­”æ¡ˆ

## æ¸¸æˆæµç¨‹

1. **ç”¨æˆ·ç™»å½•** - è¾“å…¥é‚®ç®±æ¥æ”¶éªŒè¯ç 
2. **ç­‰å¾…å¼€å§‹** - ç”¨æˆ·è¿›å…¥ç­”é¢˜é¡µé¢ç­‰å¾…
3. **ç®¡ç†å‘˜å‘é¢˜** - é€šè¿‡ç®¡ç†å¤§å±å‘å¸ƒé¢˜ç›®
4. **ç”¨æˆ·ç­”é¢˜** - 30ç§’ç­”é¢˜æ—¶é—´
5. **è‡ªåŠ¨åˆ¤å®š** - ç³»ç»Ÿè‡ªåŠ¨æ·˜æ±°ç­”é”™ç”¨æˆ·
6. **ç»§ç»­æ¸¸æˆ** - é‡å¤æµç¨‹ç›´åˆ°å‰©ä½™1äºº
7. **æ¸¸æˆç»“æŸ** - å…¬å¸ƒè·èƒœè€…

## æ•°æ®ç»“æ„

### Redis é”®å€¼è®¾è®¡

```
current_question:{room_id}    # å½“å‰é¢˜ç›®ä¿¡æ¯ (Hash)
user:{uid}:answer:{qid}       # ç”¨æˆ·ç­”é¢˜è®°å½• (String)
room:{room_id}:survivors      # å­˜æ´»ç”¨æˆ·åˆ—è¡¨ (Set)
room:{room_id}:eliminated     # æ·˜æ±°ç”¨æˆ·åˆ—è¡¨ (Set)
user:{uid}:session           # ç”¨æˆ·ä¼šè¯ä¿¡æ¯ (Hash)
verification:{email}         # éªŒè¯ç  (String, 5åˆ†é’Ÿè¿‡æœŸ)
game:{room_id}:state         # æ¸¸æˆçŠ¶æ€ (Hash)
game:{room_id}:round         # å½“å‰è½®æ¬¡ (String)
```

### é¢˜åº“æ ¼å¼

```json
[
  {
    "id": "q001",
    "question": "å“ªä¸ªæ˜¯å“ºä¹³åŠ¨ç‰©ï¼Ÿ",
    "options": {
      "A": "è›‡",
      "B": "é±¼", 
      "C": "ç‹ç‹¸",
      "D": "é¸­"
    },
    "correct_option": "C"
  }
]
```

## é‚®ä»¶é…ç½®

### Gmail é…ç½®ç¤ºä¾‹

1. å¼€å¯ä¸¤æ­¥éªŒè¯
2. ç”Ÿæˆåº”ç”¨ä¸“ç”¨å¯†ç 
3. åœ¨ `.env.local` ä¸­é…ç½®ï¼š

```env
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USER=your_email@gmail.com
EMAIL_PASS=your_16_digit_app_password
```

### å…¶ä»–é‚®ä»¶æœåŠ¡

æ”¯æŒä»»ä½• SMTP æœåŠ¡ï¼Œåªéœ€ä¿®æ”¹å¯¹åº”é…ç½®å³å¯ã€‚

## éƒ¨ç½²

### Docker éƒ¨ç½²

1. æ„å»ºé•œåƒï¼š
```bash
docker build -t lottery-system .
```

2. è¿è¡Œå®¹å™¨ï¼š
```bash
docker run -d -p 3000:3000 --env-file .env lottery-system
```

### ç”Ÿäº§ç¯å¢ƒ

æ¨èä½¿ç”¨ PM2 + NGINX éƒ¨ç½²ï¼š

1. æ„å»ºç”Ÿäº§ç‰ˆæœ¬ï¼š
```bash
npm run build
```

2. ä½¿ç”¨ PM2 å¯åŠ¨ï¼š
```bash
pm2 start npm --name "lottery" -- start
```

3. é…ç½® NGINX åå‘ä»£ç†

## å¼€å‘è¯´æ˜

### é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ app/                 # Next.js App Router
â”‚   â”œâ”€â”€ api/            # API è·¯ç”±
â”‚   â”œâ”€â”€ login/          # ç™»å½•é¡µé¢
â”‚   â”œâ”€â”€ play/           # ç­”é¢˜é¡µé¢
â”‚   â””â”€â”€ admin/          # ç®¡ç†é¡µé¢
â”œâ”€â”€ components/         # React ç»„ä»¶
â”œâ”€â”€ lib/               # å·¥å…·åº“
â”œâ”€â”€ types/             # TypeScript ç±»å‹
â””â”€â”€ data/              # é¢˜åº“æ•°æ®
```

### è‡ªå®šä¹‰é¢˜åº“

ç¼–è¾‘ `src/data/questions.json` æ–‡ä»¶æ·»åŠ æˆ–ä¿®æ”¹é¢˜ç›®ã€‚

### æ‰©å±•åŠŸèƒ½

- æ·»åŠ æ›´å¤šé¢˜ç›®ç±»å‹
- æ”¯æŒå›¾ç‰‡é¢˜ç›®
- å¢åŠ éš¾åº¦åˆ†çº§
- æ·»åŠ æ’è¡Œæ¦œåŠŸèƒ½
- æ”¯æŒå¤šæˆ¿é—´æ¸¸æˆ

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **Redis è¿æ¥å¤±è´¥**
   - æ£€æŸ¥ Redis æœåŠ¡æ˜¯å¦å¯åŠ¨
   - ç¡®è®¤ REDIS_URL é…ç½®æ­£ç¡®

2. **é‚®ä»¶å‘é€å¤±è´¥**
   - æ£€æŸ¥é‚®ç®±é…ç½®
   - ç¡®è®¤åº”ç”¨å¯†ç è®¾ç½®æ­£ç¡®

3. **Socket.IO è¿æ¥é—®é¢˜**
   - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
   - ç¡®è®¤ç«¯å£æ²¡æœ‰è¢«å ç”¨

### æ—¥å¿—æŸ¥çœ‹

```bash
# å¼€å‘ç¯å¢ƒ
npm run dev

# ç”Ÿäº§ç¯å¢ƒ
pm2 logs lottery
```

## è®¸å¯è¯

MIT License

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- æäº¤ GitHub Issue
- å‘é€é‚®ä»¶è‡³é¡¹ç›®ç»´æŠ¤è€…

---

**æ³¨æ„**: ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰è¯·åŠ¡å¿…ä¿®æ”¹é»˜è®¤çš„ JWT å¯†é’¥å’Œå…¶ä»–å®‰å…¨é…ç½®ã€‚
